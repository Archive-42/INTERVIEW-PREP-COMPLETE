<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>CommonBitManipulation</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="common-bit-manipulation">Common Bit manipulation</h1>
<p>Translator: <a href="https://github.com/Funnyyanne">Funnyyanne</a></p>
<p>Author: <a href="https://github.com/labuladong">labuladong</a></p>
<p>This article is divided into two parts. The first part lists a few interesting bitwise operations, second part explains n&amp;(n-1) trick commonly used in algorithm. By the way, I’m going to show you the algorithm for this trick. Because Bit manipulation is simple, it is assumed that the reader already knows the three basic operations of AND, OR, XOR.</p>
<p>Bit Manipulation can play a lot of fucking trick, but most of these tricks are too obscure, there is no need to dig in. We just need to remember some useful operations.</p>
<h3 id="interesting-bit-manipulations">Ⅰ.Interesting Bit manipulations</h3>
<ol type="1">
<li>Use OR ‘|’ and space bar coverts English characters to lowercase</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb1-1" title="1">(<span class="ch">&#39;a&#39;</span> | <span class="ch">&#39; &#39;</span>) = <span class="ch">&#39;a&#39;</span></a>
<a class="sourceLine" id="cb1-2" title="2">(<span class="ch">&#39;A&#39;</span> | <span class="ch">&#39; &#39;</span>) = <span class="ch">&#39;a&#39;</span></a></code></pre></div>
<ol start="2" type="1">
<li>Use AND ‘&amp;’ and underline coverts English to uppercase.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb2-1" title="1">(<span class="ch">&#39;b&#39;</span> &amp; <span class="ch">&#39;_&#39;</span>) = <span class="ch">&#39;B&#39;</span></a>
<a class="sourceLine" id="cb2-2" title="2">(<span class="ch">&#39;B&#39;</span> &amp; <span class="ch">&#39;_&#39;</span>) = <span class="ch">&#39;B&#39;</span></a></code></pre></div>
<ol start="3" type="1">
<li>Use XOR ‘^’ and space bar for English characters case exchange.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb3-1" title="1">(<span class="ch">&#39;d&#39;</span> ^ <span class="ch">&#39; &#39;</span>) = <span class="ch">&#39;D&#39;</span></a>
<a class="sourceLine" id="cb3-2" title="2">(<span class="ch">&#39;D&#39;</span> ^ <span class="ch">&#39; &#39;</span>) = <span class="ch">&#39;d&#39;</span></a></code></pre></div>
<p>PS：The reason why the operation can produce strange effects is ASCII encoding. Characters are actually Numbers, it happens that the Numbers corresponding to these characters can get the correct result through bit manipulations, if you interested in it, you can check ASCII table, this article does not expand it.</p>
<ol start="4" type="1">
<li>Determine if the sign of two numbers are different</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb4-1" title="1"><span class="dt">int</span> x = -<span class="dv">1</span>, y = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="dt">bool</span> f = ((x ^ y) &lt; <span class="dv">0</span>); <span class="co">// true</span></a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="dt">int</span> x = <span class="dv">3</span>, y = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb4-5" title="5"><span class="dt">bool</span> f = ((x ^ y) &lt; <span class="dv">0</span>); <span class="co">// false</span></a></code></pre></div>
<p>PS：This technique is very practical, and uses sign bit complement encoding. If you don’t use the bit operation to determine whether the sign is different, you need to use if else branch, which is quite troublesome. Readers may want to try to use products or quotients to determine whether two numbers have different signs, but this processing method may cause overflow and cause errors. (For complement coding and overflow, see the previous article.)</p>
<ol start="5" type="1">
<li>Swap two Numbers</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb5-1" title="1"><span class="dt">int</span> a = <span class="dv">1</span>, b = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb5-2" title="2">a ^= b;</a>
<a class="sourceLine" id="cb5-3" title="3">b ^= a;</a>
<a class="sourceLine" id="cb5-4" title="4">a ^= b;</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">// 现在 a = 2, b = 1</span></a></code></pre></div>
<ol start="6" type="1">
<li>Plus one</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb6-1" title="1"><span class="dt">int</span> n = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb6-2" title="2">n = -~n;</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">// 现在 n = 2</span></a></code></pre></div>
<ol start="7" type="1">
<li>Minus one</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb7-1" title="1"><span class="dt">int</span> n = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb7-2" title="2">n = ~-n;</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">// 现在 n = 1</span></a></code></pre></div>
<p>PS：These three operations just Show off, No practical use, we just know it.。</p>
<h3 id="algorithm-common-operations-nn-1">Ⅱ.Algorithm common operations n&amp;(n-1)</h3>
<p>This operation is the common algorithm, the function is eliminated the number n of the binary representation of the last 1.</p>
<p>It is easy to understand by looking at the picture：</p>
<figure>
<img src="../pictures/BitManipulation/1.png" alt="n" /><figcaption>n</figcaption>
</figure>
<ol type="1">
<li>Count Hamming Weight（Hamming Weight）</li>
</ol>
<figure>
<img src="../pictures/BitManipulation/title.png" alt="title" /><figcaption>title</figcaption>
</figure>
<p>Be to let you return several ones in the binary representation of n’s one. Because n &amp; (n-1) can eliminate the last one, you can use a loop to eliminate 1 and count at the same time until n becomes 0.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb8-1" title="1"><span class="dt">int</span> hammingWeight(<span class="dt">uint32_t</span> n) {</a>
<a class="sourceLine" id="cb8-2" title="2">    <span class="dt">int</span> res = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb8-3" title="3">    <span class="cf">while</span> (n != <span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb8-4" title="4">        n = n &amp; (n - <span class="dv">1</span>);</a>
<a class="sourceLine" id="cb8-5" title="5">        res++;</a>
<a class="sourceLine" id="cb8-6" title="6">    }</a>
<a class="sourceLine" id="cb8-7" title="7">    <span class="cf">return</span> res;</a>
<a class="sourceLine" id="cb8-8" title="8">}</a></code></pre></div>
<ol type="1">
<li>Determine if a number is an exponent of 2</li>
</ol>
<p>If a number is an exponent of 2, its binary representation must contain only one 1:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb9-1" title="1"><span class="dv">2</span>^<span class="dv">0</span> = <span class="dv">1</span> = <span class="bn">0b0001</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="dv">2</span>^<span class="dv">1</span> = <span class="dv">2</span> = <span class="bn">0b0010</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="dv">2</span>^<span class="dv">2</span> = <span class="dv">4</span> = <span class="bn">0b0100</span></a></code></pre></div>
<p>If you use the bit operation technique, it is very simple (note the precedence of the operator, the parentheses cannot be omitted) :</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb10-1" title="1"><span class="dt">bool</span> isPowerOfTwo(<span class="dt">int</span> n) {</a>
<a class="sourceLine" id="cb10-2" title="2">    <span class="cf">if</span> (n &lt;= <span class="dv">0</span>) <span class="cf">return</span> <span class="kw">false</span>;</a>
<a class="sourceLine" id="cb10-3" title="3">    <span class="cf">return</span> (n &amp; (n - <span class="dv">1</span>)) == <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb10-4" title="4">}</a></code></pre></div>
<p>The above are some interesting / common bit manipulation. In fact, there are many bit manipulation techniques. There is a foreign website called Bit Twiddling Hacks which collects almost all black technology gameplays of bit manipulation. Interested readers can search to view.</p>
</body>
</html>
